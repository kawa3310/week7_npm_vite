import{_ as B,o as r,c,a as t,t as a,b as h,w,v as S,d as _,S as d,r as g,e as u,F as k,f as I,g as q,n as E,h as b,i as V}from"./index-NuIqTYBe.js";import{M as P}from"./bootstrap.esm-TTjMTX3M.js";const D={data(){return{status:{},modal:null,qty:1}},props:["product","addProduct"],methods:{openModal(){this.modal.show()},closeModal(){this.modal.hide()}},mounted(){this.modal=new P(this.$refs.modal)}},L={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},T={class:"modal-dialog modal-xl",role:"document"},F={class:"modal-content border-0"},$={class:"modal-header bg-dark text-white"},R={class:"modal-title",id:"exampleModalLabel"},z=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),N={class:"modal-body"},O={class:"row"},A={class:"col-sm-6"},H=["src"],j=["src"],G={class:"col-sm-6"},J={class:"badge bg-primary rounded-pill"},K={key:0,class:"h5"},Q={class:"h6"},W={class:"h5"},X={class:"input-group"};function Y(i,s,l,v,o,m){return r(),c("div",L,[t("div",T,[t("div",F,[t("div",$,[t("h5",R,[t("span",null,a(l.product.title),1)]),z]),t("div",N,[t("div",O,[t("div",A,[t("img",{class:"img-fluid",src:l.product.imageUrl,alt:""},null,8,H),t("img",{class:"img-fluid mt-3",src:l.product.imagesUrl,alt:"",style:{width:"60px"}},null,8,j)]),t("div",G,[t("span",J,a(l.product.category),1),t("p",null,"商品描述："+a(l.product.description),1),t("p",null,"商品內容："+a(l.product.content),1),l.product.price?h("",!0):(r(),c("div",K,a(l.product.origin_price)+" 元",1)),t("del",Q,"原價 "+a(l.product.origin_price)+" 元",1),t("div",W,"現在只要 "+a(l.product.price)+" 元",1),t("div",null,[t("div",X,[w(t("input",{type:"number",class:"form-control",min:"1","onUpdate:modelValue":s[0]||(s[0]=y=>o.qty=y)},null,512),[[S,o.qty,void 0,{number:!0}]]),t("button",{type:"button",class:"btn btn-primary",onClick:s[1]||(s[1]=y=>l.addProduct(l.product.id,o.qty))},"加入購物車")])])])])])])])],512)}const Z=B(D,[["render",Y]]);var tt={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"reirei",BASE_URL:"/week7_npm_vite/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:p,VITE_PATH:f}=tt,et={data(){return{loadingState:{isId:""},isloading:!1,products:[],product:{},cart:{},qty:1,userPtModal:null,form:{user:{name:"",email:"",tel:"",address:""},message:""}}},methods:{getDatas(){this.isloading=!0,_.get(`${p}/api/${f}/products/all`).then(i=>{this.isloading=!1,this.products=i.data.products}).catch(i=>{this.isloading=!1,d.fire({toast:!0,position:"center",showConfirmButton:!1,timer:1500,icon:"error",title:i.response.data.message})})},getData(i){this.isloading=!0,this.loadingState.isId=i,_.get(`${p}/api/${f}/product/${i}`).then(s=>{this.isloading=!1,this.loadingState.isId="",this.product=s.data.product,this.$refs.modal.openModal()}).catch(s=>{this.isloading=!1,d.fire({toast:!0,position:"center",showConfirmButton:!1,timer:1500,icon:"error",title:s.response.data.message})})},getCart(){this.isloading=!0,_.get(`${p}/api/${f}/cart`).then(i=>{this.isloading=!1,this.cart=i.data.data}).catch(i=>{this.isloading=!1,d.fire({toast:!0,position:"center",showConfirmButton:!1,timer:1500,icon:"error",title:i.response.data.message})})},addProduct(i,s=1){this.loadingState.isId=i;const l={product_id:i,qty:s};this.isloading=!0,_.post(`${p}/api/${f}/cart`,{data:l}).then(v=>{this.isloading=!1,this.loadingState.isId="",this.$refs.modal.closeModal(),this.getCart(),d.fire({toast:!0,position:"center",showConfirmButton:!1,timer:1500,icon:"success",title:"已加入購物車"})}).catch(v=>{this.isloading=!1,d.fire({toast:!0,position:"center",showConfirmButton:!1,timer:1500,icon:"error",title:v.response.data.message})})},delCart(i){this.isloading=!0,this.loadingState.isId=i,_.delete(`${p}/api/${f}/cart/${i}`).then(s=>{this.isloading=!1,this.loadingState.isId="",this.getCart(),d.fire({toast:!0,position:"center",showConfirmButton:!1,timer:1500,icon:"success",title:"已刪除"})}).catch(s=>{this.isloading=!1,d.fire({toast:!0,position:"center",showConfirmButton:!1,timer:1500,icon:"error",title:s.response.data.message})})},delItems(){this.isloading=!0,d.fire({icon:"question",title:"刪除所有購物車",text:"確定要刪除所有購物車嗎？",showCancelButton:!0}).then(i=>{_.delete(`${p}/api/${f}/carts`).then(s=>{this.isloading=!1,this.getCart(),d.fire({toast:!0,position:"center",showConfirmButton:!1,timer:1500,icon:"success",title:"已刪除全部購物車"})}).catch(s=>{this.isloading=!1,d.fire({toast:!0,position:"center",showConfirmButton:!1,timer:1500,icon:"error",title:s.response.data.message})})})},updateStatus(i){this.isloading=!0,this.loadingState.isId=i.id;const s={product_id:i.product_id,qty:i.qty};_.put(`${p}/api/${f}/cart/${i.id}`,{data:s}).then(l=>{this.isloading=!1,this.loadingState.isId="",this.getCart()}).catch(l=>{this.isloading=!1,d.fire({toast:!0,position:"center",showConfirmButton:!1,timer:1500,icon:"error",title:l.response.data.message})})},addOrder(){if(this.cart.carts.length===0)d.fire({position:"center",icon:"warning",title:"你的購物車是空的，無法送出訂單",showConfirmButton:!1,timer:1500});else{const i=this.form;this.isloading=!0,_.post(`${p}/api/${f}/order`,{data:i}).then(s=>{this.isloading=!1,this.$refs.form.resetForm(),this.loadingState.isId="",this.getCart(),d.fire({toast:!0,position:"center",showConfirmButton:!1,timer:1500,icon:"success",title:"訂單已送出"})}).catch(s=>{this.isloading=!1,d.fire({toast:!0,position:"center",showConfirmButton:!1,timer:1500,icon:"error",title:s.response.data.message})})}}},mounted(){this.getDatas(),this.getCart()},components:{UserProductsModal:Z}},st={class:"container"},ot={class:"mt-4"},it={class:"table align-middle"},lt=t("thead",null,[t("tr",null,[t("th",null,"圖片"),t("th",null,"商品名稱"),t("th",null,"價格"),t("th")])],-1),at={style:{width:"200px"}},nt={key:0,calss:"h5"},dt={class:"h6"},rt={class:"h5"},ct={class:"btn-group btn-group-sm"},ut=["onClick","disabled"],mt={key:0,class:"fas fa-spinner fa-pulse"},ht=["onClick","disabled"],_t={key:0,class:"fas fa-spinner fa-pulse"},pt={class:"text-end"},ft={class:"table align-middle"},gt=t("thead",null,[t("tr",null,[t("th"),t("th",null,"品名"),t("th",{style:{width:"150px"}},"數量/單位"),t("th",{class:"text-end"},"單價")])],-1),bt=["onClick","disabled"],vt={key:0,class:"fas fa-spinner fa-pulse"},yt={key:0,class:"text-success"},xt={class:"input-group input-group-sm"},Ct={class:"input-group mb-3"},Vt=["onUpdate:modelValue","onBlur","disabled"],kt={class:"input-group-text",id:"basic-addon2"},wt={class:"text-end"},St={key:0,class:"text-success"},It=t("td",{colspan:"3",class:"text-end"},"總計",-1),Bt={class:"text-end"},Mt={key:0},Ut=t("td",{colspan:"3",class:"text-end text-success"},"折扣價",-1),qt={class:"text-end text-success"},Et={class:"my-5 row justify-content-center"},Pt={class:"mb-3"},Dt=t("label",{for:"email",class:"form-label"},"Email",-1),Lt={class:"mb-3"},Tt=t("label",{for:"name",class:"form-label"},"收件人姓名",-1),Ft={class:"mb-3"},$t=t("label",{for:"tel",class:"form-label"},"收件人電話",-1),Rt={class:"mb-3"},zt=t("label",{for:"address",class:"form-label"},"收件人地址",-1),Nt={class:"mb-3"},Ot=t("label",{for:"message",class:"form-label"},"留言",-1),At=t("div",{class:"text-end"},[t("button",{type:"submit",class:"btn btn-danger"},"送出訂單")],-1);function Ht(i,s,l,v,o,m){const y=g("VueLoading"),M=g("UserProductsModal"),x=g("VField"),C=g("ErrorMessage"),U=g("VForm");return r(),c(k,null,[u(y,{active:o.isloading,"z-index":1060},null,8,["active"]),t("div",st,[t("div",ot,[u(M,{ref:"modal",product:o.product,"add-product":m.addProduct},null,8,["product","add-product"]),t("table",it,[lt,t("tbody",null,[(r(!0),c(k,null,I(o.products,e=>(r(),c("tr",{key:e.id},[t("td",at,[t("div",{style:E([{height:"100px","background-size":"cover","background-position":"center"},{backgroundImage:`url(${e.imageUrl})`}])},null,4)]),t("td",null,a(e.title),1),t("td",null,[e.price?h("",!0):(r(),c("div",nt,a(e.origin_price),1)),t("del",dt,"原價 "+a(e.origin_price)+" 元",1),t("div",rt,"現在只要 "+a(e.price)+" 元",1)]),t("td",null,[t("div",ct,[t("button",{type:"button",class:"btn btn-outline-secondary",onClick:n=>m.getData(e.id),disabled:o.loadingState.isId===e.id||!e.is_enabled},[o.loadingState.isId===e.id?(r(),c("i",mt)):h("",!0),b(" 查看更多 ")],8,ut),t("button",{type:"button",class:"btn btn-outline-danger",onClick:n=>m.addProduct(e.id),disabled:o.loadingState.isId===e.id||!e.is_enabled},[o.loadingState.isId===e.id?(r(),c("i",_t)):h("",!0),b(" 加到購物車 ")],8,ht)])])]))),128))])]),t("div",pt,[t("button",{class:"btn btn-outline-danger",type:"button",onClick:s[0]||(s[0]=(...e)=>m.delItems&&m.delItems(...e))},"清空購物車")]),t("table",ft,[gt,t("tbody",null,[o.cart.carts?(r(!0),c(k,{key:0},I(o.cart.carts,e=>(r(),c("tr",{key:e.id},[t("td",null,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:n=>m.delCart(e.id),disabled:o.loadingState.isId===e.id},[o.loadingState.isId===e.id?(r(),c("i",vt)):h("",!0),b(" x ")],8,bt)]),t("td",null,[b(a(e.product.title)+" ",1),e.coupon?(r(),c("div",yt," 已套用優惠券 ")):h("",!0)]),t("td",null,[t("div",xt,[t("div",Ct,[w(t("input",{min:"1",type:"number",class:"form-control","onUpdate:modelValue":n=>e.qty=n,onBlur:n=>m.updateStatus(e),disabled:o.loadingState.isId===e.id},null,40,Vt),[[S,e.qty,void 0,{number:!0}]]),t("span",kt,a(e.product.unit),1)])])]),t("td",wt,[e.final_total!==e.total?(r(),c("small",St,"折扣價：")):h("",!0),b(" "+a(e.final_total),1)])]))),128)):h("",!0)]),t("tfoot",null,[t("tr",null,[It,t("td",Bt,a(o.cart.total),1)]),o.cart.final_total!==o.cart.total?(r(),c("tr",Mt,[Ut,t("td",qt,a(o.cart.final_total),1)])):h("",!0)])])]),t("div",Et,[u(U,{ref:"form",class:"col-md-6",onSubmit:m.addOrder},{default:q(({errors:e})=>[t("div",Pt,[Dt,u(x,{id:"email",name:"email",type:"email",class:V(["form-control",{"is-invalid":e.email}]),placeholder:"請輸入 Email",rules:"email|required",modelValue:o.form.user.email,"onUpdate:modelValue":s[1]||(s[1]=n=>o.form.user.email=n)},null,8,["class","modelValue"]),u(C,{name:"email",class:"invalid-feedback"})]),t("div",Lt,[Tt,u(x,{id:"name",name:"姓名",type:"text",class:V(["form-control",{"is-invalid":e.姓名}]),placeholder:"請輸入姓名",rules:"required",modelValue:o.form.user.name,"onUpdate:modelValue":s[2]||(s[2]=n=>o.form.user.name=n)},null,8,["class","modelValue"]),u(C,{name:"姓名",class:"invalid-feedback"})]),t("div",Ft,[$t,u(x,{id:"tel",name:"電話",type:"text",class:V(["form-control",{"is-invalid":e.電話}]),placeholder:"請輸入電話，ex:092345532",rules:"required|min:9|max:10",modelValue:o.form.user.tel,"onUpdate:modelValue":s[3]||(s[3]=n=>o.form.user.tel=n)},null,8,["class","modelValue"]),u(C,{name:"電話",class:"invalid-feedback"})]),t("div",Rt,[zt,u(x,{id:"address",name:"地址",type:"text",class:V(["form-control",{"is-invalid":e.地址}]),placeholder:"請輸入地址",rules:"required",modelValue:o.form.user.address,"onUpdate:modelValue":s[4]||(s[4]=n=>o.form.user.address=n)},null,8,["class","modelValue"]),u(C,{name:"地址",class:"invalid-feedback"})]),t("div",Nt,[Ot,w(t("textarea",{id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":s[5]||(s[5]=n=>o.form.message=n)},null,512),[[S,o.form.message]])]),At]),_:1},8,["onSubmit"])])])],64)}const Jt=B(et,[["render",Ht]]);export{Jt as default};
