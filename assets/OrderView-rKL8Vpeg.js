import{a as _,S as u}from"./sweetalert2.all-dSUELRW9.js";import{_ as y,o as r,c as l,a as e,t as d,b as k,F as p,e as w,w as M,j as v,r as f,d as g,h as x}from"./index-jwbIZMgy.js";import{P as S,D as V}from"./DelProductModal-ip9lxc7O.js";import{M as E}from"./bootstrap.esm-TTjMTX3M.js";const L={data(){return{orderModal:null,emitOrder:{},is_paid:!1}},props:["tempOrder","isNew","addOrderStates"],emits:["addOrderStates"],methods:{modelOpen(){this.orderModal.show()},modalClose(){this.orderModal.hide()},currency(t){return`${parseInt(t,10).toFixed(0).replace(/./g,(c,m,s)=>m&&c!=="."&&(s.length-m)%3===0?`, ${c}`.replace(/\s/g,""):c)}`},date(t){return new Date(t*1e3).toLocaleDateString()}},mounted(){this.orderModal=new E(this.$refs.orderModal),this.emitOrder=this.tempOrder},watch:{tempOrder(){this.emitOrder=this.tempOrder}}},P={id:"orderModal",ref:"orderModal",class:"modal fade",tabindex:"-1","aria-labelledby":"orderModalLabel","aria-hidden":"true"},N={class:"modal-dialog modal-dialog-centered modal-dialog-scrollable"},B={class:"modal-content border-0"},I=e("div",{class:"modal-header bg-dark text-white"},[e("h5",{id:"orderModalLabel",class:"modal-title"},[e("span",null,"訂單細節")]),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),T={class:"modal-body"},A={class:"row"},U={class:"col-md-16"},R=e("h3",null,"訂單資料",-1),z={class:"table"},F={key:0},j=e("th",{style:{width:"100px"}},"訂單編號",-1),H=e("th",null,"訂單時間",-1),q=e("th",{style:{width:"100px"}},"收件人",-1),G=e("th",null,"Email",-1),J=e("th",null,"聯絡電話",-1),K=e("th",null,"收件地址",-1),Q=e("th",null,"付款狀態",-1),W={key:0},X={key:1},Y=e("th",null,"總金額",-1),Z=e("h3",null,"選購商品",-1),ee={class:"table"},te=e("thead",null,[e("tr")],-1),se={class:"d-flex justify-content-end"},oe={class:"form-check"},re={class:"form-check-label",for:"flexCheckDefault"},le={key:0},de={key:1},ne={class:"modal-footer"},ie=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function ae(t,o,c,m,s,a){return r(),l("div",P,[e("div",N,[e("div",B,[I,e("div",T,[e("div",A,[e("div",U,[R,e("table",z,[s.emitOrder.user?(r(),l("tbody",F,[e("tr",null,[j,e("td",null,d(s.emitOrder.id),1)]),e("tr",null,[H,e("td",null,d(a.date(s.emitOrder.create_at)),1)]),e("tr",null,[q,e("td",null,d(s.emitOrder.user.name),1)]),e("tr",null,[G,e("td",null,d(s.emitOrder.user.email),1)]),e("tr",null,[J,e("td",null,d(s.emitOrder.user.tel),1)]),e("tr",null,[K,e("td",null,d(s.emitOrder.user.address),1)]),e("tr",null,[Q,e("td",null,[s.emitOrder.paid_date?(r(),l("span",W,"已付款")):(r(),l("span",X,"尚未付款"))])]),e("tr",null,[Y,e("td",null,"$"+d(s.emitOrder.total),1)])])):k("",!0)]),Z,e("table",ee,[te,e("tbody",null,[(r(!0),l(p,null,w(s.emitOrder.products,i=>(r(),l("tr",{key:i.id},[e("th",null,d(i.product.title),1),e("td",null,d(i.qty)+" / "+d(i.product.unit),1),e("td",null,d(i.product.final_total),1),e("td",null,d(a.currency(i.final_total)),1)]))),128))])]),e("div",se,[e("div",oe,[M(e("input",{class:"form-check-input",type:"checkbox",value:"",id:"flexCheckDefault","onUpdate:modelValue":o[0]||(o[0]=i=>s.emitOrder.is_paid=i)},null,512),[[v,s.emitOrder.is_paid]]),e("label",re,[s.emitOrder.is_paid?(r(),l("span",le,"已付款")):(r(),l("span",de,"未付款"))])])])])])]),e("div",ne,[ie,e("button",{type:"button",class:"btn btn-primary",onClick:o[1]||(o[1]=i=>t.$emit("addOrderStates",s.emitOrder))}," 修改狀態 ")])])])],512)}const ce=y(L,[["render",ae]]);var he={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"reirei",BASE_URL:"/week7_npm_vite/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:O,VITE_PATH:b}=he,ue={data(){return{pagination:{},orderData:{},tempOrder:{},pages:{},isNew:!1,isloading:!1}},methods:{cheakLongin(){_.post(`${O}/api/user/check`).then(t=>{this.getOrders()}).catch(t=>{this.$router.push("/login"),u.fire({toast:!0,position:"center",showConfirmButton:!1,timer:1500,icon:"error",title:t.response.data.message})})},getOrders(t=1){this.isloading=!0,_.get(`${O}/api/${b}/admin/orders?page=${t}`).then(o=>{this.isloading=!1,this.orderData=o.data.orders,this.pages=o.data.pagination}).catch(o=>{this.isloading=!0,u.fire({toast:!0,position:"center",showConfirmButton:!1,timer:1500,icon:"error",title:o.response.data.message})})},openModel(t,o){this.isNew=!0,t==="look"?(this.isNew=!1,this.tempOrder={...o},this.$refs.orderModal.modelOpen()):t==="dele"&&(this.tempOrder={...o},this.$refs.deModal.modelOpen())},addOrderStates(t){this.isNew=!0,this.isloading=!0;const o={is_paid:t.is_paid};_.put(`${O}/api/${b}/admin/order/${t.id}`,{data:o}).then(c=>{this.isNew=!1,this.isloading=!1,this.$refs.orderModal.modalClose(),this.getOrders(),u.fire({toast:!0,position:"center",showConfirmButton:!1,timer:1500,icon:"success",title:"編輯成功"})}).catch(c=>{this.isloading=!1,u.fire({toast:!0,position:"center",showConfirmButton:!1,timer:1500,icon:"error",title:c.response.data.message})})},delOrder(){this.isNew=!0,this.isloading=!0,_.delete(`${O}/api/${b}/admin/order/${this.tempOrder.id}`).then(t=>{this.isNew=!1,this.isloading=!1,this.$refs.deModal.modalClose(),this.getOrders(),u.fire({toast:!0,position:"center",showConfirmButton:!1,timer:1500,icon:"success",title:"刪除成功"})}).catch(t=>{this.isloading=!1,u.fire({toast:!0,position:"center",showConfirmButton:!1,timer:1500,icon:"error",title:t.response.data.message})})},date(t){return new Date(t*1e3).toLocaleDateString()}},mounted(){const t=document.cookie.replace(/(?:(?:^|.*;\s*)kawaToken\s*=\s*([^;]*).*$)|^.*$/,"$1");_.defaults.headers.common.Authorization=t,this.cheakLongin()},components:{PaginationModal:S,OrderModal:ce,DelProductModal:V}},_e={class:"container"},pe={class:"text-end mt-4"},me={class:"table mt-4"},fe=e("thead",null,[e("tr",null,[e("th",{width:"120"},"購買日期"),e("th",{width:"120"},"Email"),e("th",{width:"120"},"品項"),e("th",{width:"120"},"應付金額"),e("th",{width:"120"},"付款狀態"),e("th",{width:"120"},"編輯")])],-1),ge=["textContent"],Oe={class:"list-unstyled"},be={class:"form-check form-switch"},ke=["onUpdate:modelValue","id","onChange"],we=["for"],ye={key:0},Me={key:1},ve={class:"btn-group"},Ce=["onClick"],De=["onClick"];function $e(t,o,c,m,s,a){const i=f("VueLoading"),C=f("PaginationModal"),D=f("OrderModal"),$=f("DelProductModal");return r(),l(p,null,[g(i,{active:s.isloading,"z-index":1060},null,8,["active"]),e("div",_e,[e("div",pe,[e("table",me,[fe,e("tbody",null,[(r(!0),l(p,null,w(s.orderData,n=>(r(),l(p,{key:n.id},[s.orderData.length?(r(),l("tr",{key:0,class:x({"text-secondary":!n.is_paid})},[e("td",null,d(a.date(n.create_at)),1),e("td",null,[n.user?(r(),l("span",{key:0,textContent:d(n.user.email)},null,8,ge)):k("",!0)]),e("td",null,[e("ul",Oe,[(r(!0),l(p,null,w(n.products,h=>(r(),l("li",{key:h.id},d(h.product.title),1))),128))])]),e("td",null,d(n.total),1),e("td",null,[e("div",be,[M(e("input",{class:"form-check-input","onUpdate:modelValue":h=>n.is_paid=h,type:"checkbox",role:"switch",id:`paidSwitch${n.id}`,onChange:h=>a.addOrderStates(n)},null,40,ke),[[v,n.is_paid]]),e("label",{class:"form-check-label",for:`paidSwitch${n.id}`},[n.is_paid?(r(),l("span",ye,"已付款")):(r(),l("span",Me,"未付款"))],8,we)])]),e("div",ve,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:h=>a.openModel("look",n)}," 查看 ",8,Ce),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:h=>a.openModel("dele",n)}," 刪除 ",8,De)])],2)):k("",!0)],64))),128))])])])]),g(C,{pages:s.pages,onEmitPages:a.getOrders},null,8,["pages","onEmitPages"]),g(D,{"temp-Order":s.tempOrder,ref:"orderModal",onAddOrderStates:a.addOrderStates},null,8,["temp-Order","onAddOrderStates"]),g($,{item:s.tempOrder,onDelItem:a.delOrder,ref:"deModal"},null,8,["item","onDelItem"])],64)}const Le=y(ue,[["render",$e]]);export{Le as default};
