import{a as u,S as r}from"./sweetalert2.all-dSUELRW9.js";import{_ as g,o as l,c as a,a as e,w as h,v as p,j as D,r as _,d as f,F as v,e as C,t as b}from"./index-jwbIZMgy.js";import{M as x}from"./bootstrap.esm-TTjMTX3M.js";import{D as P,P as E}from"./DelProductModal-ip9lxc7O.js";const B={data(){return{voucher:null,emitVoucher:{},due_date:""}},props:["tempVoucher","isNew"],methods:{modelOpen(){this.voucher.show()},modalClose(){this.voucher.hide()}},mounted(){this.voucher=new x(this.$refs.VoucherModal)},watch:{tempVoucher(){this.emitVoucher=this.tempVoucher},due_date(){this.emitVoucher.due_date=Math.floor(new Date(this.due_date)/1e3)}}},L={id:"VoucherModal",ref:"VoucherModal",class:"modal fade",tabindex:"-1","aria-labelledby":"VoucherModalLabel","aria-hidden":"true"},N={class:"modal-dialog",role:"document"},T={class:"modal-content"},U={class:"modal-header"},I={id:"VoucherModalLabel",class:"modal-title"},O={key:0},S={key:1},R=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),A={class:"modal-body"},z={class:"mb-3"},F=e("label",{for:"title",class:"form-label"},"優惠卷標題",-1),H={class:"mb-3"},j=e("label",{for:"coupon_code",class:"form-label"},"優惠碼",-1),q={class:"mb-3"},G=e("label",{for:"due_date"},"使用期限",-1),J={class:"mb-3"},K=e("label",{for:"title",class:"form-label"},"折扣",-1),Q={class:"mb-3"},W={class:"form-check"},X=e("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),Y={class:"modal-footer"},Z=e("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function ee(t,o,c,w,s,d){return l(),a("div",L,[e("div",N,[e("div",T,[e("div",U,[e("h5",I,[c.isNew?(l(),a("span",O,"新增優惠卷")):(l(),a("span",S,"編輯優惠卷"))]),R]),e("div",A,[e("div",z,[F,h(e("input",{"onUpdate:modelValue":o[0]||(o[0]=i=>s.emitVoucher.title=i),id:"title",type:"text",class:"form-control",placeholder:"請輸入優惠卷標題"},null,512),[[p,s.emitVoucher.title]])]),e("div",H,[j,h(e("input",{"onUpdate:modelValue":o[1]||(o[1]=i=>s.emitVoucher.code=i),id:"coupon_code",type:"text",class:"form-control",placeholder:"請輸入優惠碼"},null,512),[[p,s.emitVoucher.code]])]),e("div",q,[G,h(e("input",{"onUpdate:modelValue":o[2]||(o[2]=i=>s.due_date=i),id:"due_date",type:"date",class:"form-control"},null,512),[[p,s.due_date]])]),e("div",J,[K,h(e("input",{"onUpdate:modelValue":o[3]||(o[3]=i=>s.emitVoucher.percent=i),id:"title",type:"text",class:"form-control",placeholder:"請輸入折扣百分比"},null,512),[[p,s.emitVoucher.percent,void 0,{number:!0}]])]),e("div",Q,[e("div",W,[h(e("input",{"true-value":1,"false-value":0,"onUpdate:modelValue":o[4]||(o[4]=i=>s.emitVoucher.is_enabled=i),id:"is_enabled",class:"form-check-input",type:"checkbox"},null,512),[[D,s.emitVoucher.is_enabled]]),X])])]),e("div",Y,[Z,e("button",{type:"button",class:"btn btn-primary",onClick:o[5]||(o[5]=i=>t.$emit("edit-Voucher",s.emitVoucher))}," 確認 ")])])])],512)}const te=g(B,[["render",ee]]);var oe={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"reirei",BASE_URL:"/week7_npm_vite/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:m,VITE_PATH:V}=oe,se={data(){return{voucher:{},tempVoucher:{title:"",is_enabled:0,percent:100,code:""},isNew:!1,pages:{},isloading:!1}},methods:{cheakLongin(){u.post(`${m}/api/user/check`).then(t=>{this.getVoucherData()}).catch(t=>{r.fire({toast:!0,position:"center",showConfirmButton:!1,timer:1500,icon:"error",title:t.response.data.message}),this.$router.push("/login")})},getVoucherData(){this.isloading=!0,u.get(`${m}/api/${V}/admin/coupons`).then(t=>{this.isloading=!1,this.voucher=t.data.coupons,this.pages=t.data.pagination}).catch(t=>{this.isloading=!1,r.fire({toast:!0,position:"center",showConfirmButton:!1,timer:1500,title:t.response.data.message})})},openModel(t,o){t==="new"?(this.isNew=!0,this.tempVoucher={due_data:new Date().getTime()/1e3},this.$refs.voucher.modelOpen()):t==="edit"?(this.isNew=!1,this.tempVoucher={...o},this.$refs.voucher.modelOpen()):t==="dele"&&(this.tempVoucher={...o},this.$refs.deModal.modelOpen())},editVoucher(){let t=`${m}/api/${V}/admin/coupon`,o="post";this.isNew||(t=`${m}/api/${V}/admin/coupon/${this.tempVoucher.id}`,o="put"),this.isloading=!0,u[o](t,{data:this.tempVoucher}).then(c=>{r.fire({toast:!0,position:"center",showConfirmButton:!1,timer:1500,icon:"success",title:"編輯成功"}),this.isloading=!1,this.$refs.voucher.modalClose(),this.getVoucherData()}).catch(c=>{this.isloading=!1,r.fire({toast:!0,position:"center",showConfirmButton:!1,timer:1500,icon:"error",title:c.response.data.message})})},delProduct(){this.isloading=!0,u.delete(`${m}/api/${V}/admin/coupon/${this.tempVoucher.id}`).then(t=>{this.isloading=!1,this.$refs.deModal.modalClose(),this.getVoucherData(),r.fire({toast:!0,position:"center",showConfirmButton:!1,timer:1500,icon:"success",title:"已刪除"})}).catch(t=>{this.isloading=!1,r.fire({toast:!0,position:"center",showConfirmButton:!1,timer:1500,icon:"error",title:t.response.data.message})})}},mounted(){const t=document.cookie.replace(/(?:(?:^|.*;\s*)kawaToken\s*=\s*([^;]*).*$)|^.*$/,"$1");u.defaults.headers.common.Authorization=t,this.getVoucherData()},components:{VoucherModal:te,DelProductModal:P,PaginationModal:E}},ie={class:"container"},ne={class:"text-end mt-4"},le={class:"text-end mt-4"},ae={class:"table mt-4"},de=e("thead",null,[e("tr",null,[e("th",{width:"120"},"名稱"),e("th",{width:"120"},"折扣百分比"),e("th",{width:"120"},"到期日"),e("th",{width:"120"},"是否啟用"),e("th",{width:"120"},"編輯")])],-1),re={key:0,class:"text-success"},ce={key:1},ue={class:"btn-group"},he=["onClick"],me=["onClick"];function pe(t,o,c,w,s,d){const i=_("VueLoading"),M=_("PaginationModal"),k=_("VoucherModal"),y=_("DelProductModal");return l(),a(v,null,[f(i,{active:s.isloading,"z-index":1060},null,8,["active"]),e("div",ie,[e("div",ne,[e("button",{class:"btn btn-primary",onClick:o[0]||(o[0]=n=>d.openModel("new",t.item))}," 建立優惠卷 ")]),e("div",le,[e("table",ae,[de,e("tbody",null,[(l(!0),a(v,null,C(s.voucher,n=>(l(),a("tr",{key:n.id},[e("td",null,b(n.title),1),e("td",null,b(n.percent)+"%",1),e("td",null,b(t.$date.date(n.due_date)),1),e("td",null,[n.is_enabled?(l(),a("span",re,"啟用")):(l(),a("span",ce,"未啟用"))]),e("td",null,[e("div",ue,[e("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:$=>d.openModel("edit",n)}," 編輯 ",8,he),e("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:$=>d.openModel("dele",n)}," 刪除 ",8,me)])])]))),128))])])])]),f(M,{pages:s.pages,onEmitPages:d.getVoucherData},null,8,["pages","onEmitPages"]),f(k,{"is-New":s.isNew,"temp-Voucher":s.tempVoucher,onEditVoucher:d.editVoucher,ref:"voucher"},null,8,["is-New","temp-Voucher","onEditVoucher"]),f(y,{onDelItem:d.delProduct,"temp-Voucher":s.tempVoucher,ref:"deModal"},null,8,["onDelItem","temp-Voucher"])],64)}const ve=g(se,[["render",pe]]);export{ve as default};
